__require=function t(e,i,o){function n(s,a){if(!i[s]){if(!e[s]){var l=s.split("/");if(l=l[l.length-1],!e[l]){var c="function"==typeof __require&&__require;if(!a&&c)return c(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+s+"'")}}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){return n(e[s][1][t]||t)},h,h.exports,t,e,i,o)}return i[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<o.length;s++)n(o[s]);return n}({Controller:[function(t,e,i){"use strict";cc._RF.push(e,"f0069KhIZRMS6S/reWAwBEl","Controller");t("Jythons");cc.Class({extends:cc.Component,properties:{images:{default:null,type:t("TextureMatch")},loginSystemNode:{default:null,type:cc.Node},prepareSystemNode:{default:null,type:cc.Node},gameSystemNode:{default:null,type:cc.Node},connectNumLabel:{default:null,type:cc.Label}},onLoad:function(){this.varify=!1,this.userId=null,this.needready=!1,this.onReady=!1,this.role=null,this.specialPower=[],this.players=[],this.hasPercival=!1,this.players_num=0,this.tokenNeed=null},start:function(){this.loginSystem=this.loginSystemNode.getComponent("LoginSystem"),this.prepareSystem=this.prepareSystemNode.getComponent("PrepareSystem"),this.gameSystem=this.gameSystemNode.getComponent("GameSystem")},toPreparePage:function(t){this.varify=!0,this.userId=t.id,this.loginSystem.node.active=!1,this.prepareSystem.node.active=!0,this.connectNumLabel.string="\u9023\u7dda\u4eba\u6578: "+t.players_num},startGame:function(t){this.needready=!1,this.onReady=!1,this.role=t.role,this.specialPower=t.special_power,this.players=t.players,this.hasPercival=t.has_percival,this.tokenNeed=t.token_need,this.players_num=t.players.length,this.characters=t.characters,this.prepareSystem.node.active=!1,this.gameSystem.node.active=!0}}),cc._RF.pop()},{Jythons:"Jythons",TextureMatch:"TextureMatch"}],GameSystem:[function(t,e,i){"use strict";cc._RF.push(e,"2751cBOJpZGEKc0WdzjCZxa","GameSystem");var o=t("NetControl"),n=t("Jythons");cc.Class({extends:cc.Component,properties:{playerPrefab:{default:null,type:cc.Prefab},controller:{default:null,type:t("Controller")},tokenGroup:{default:null,type:cc.Node},failedNode:{default:null,type:cc.Node},confirm:{default:null,type:cc.Node},cards:{default:null,type:cc.Node},showCards:{default:null,type:cc.Node},existCards:{default:null,type:cc.Node},recordsNode:{default:null,type:cc.Node},story:{default:null,type:cc.Node},storyLabel:{default:null,type:cc.Label},vote:{default:null,type:cc.Node},reject:{default:null,type:cc.Node},approve:{default:null,type:cc.Node},mission:{default:null,type:cc.Node},success:{default:null,type:cc.Node},fail:{default:null,type:cc.Node}},onLoad:function(){this.captain=null,this.round=0,this.failed=0,this.chosing=!1,this.confirming=!1,this.assassin=!1,this.teamates=[],this.STORYTIME=2.5,this.PERCIVALSTORY=[{text:"\u6d3e\u897f\u7dad\u723e\u775c\u773c\n\n\u9b54\u7518\u5a1c\u548c\u6885\u6797\u8c4e\u8d77\u5927\u62c7\u6307",callback:this.percivalSee.bind(this)},{text:"\u6d3e\u897f\u7dad\u723e\u9589\u773c\n\n\u9b54\u7518\u5a1c\u548c\u6885\u6797\u628a\u624b\u6536\u8d77\u4f86"}],this.ENDSTORY={text:"\u5929\u4eae\u4e86\n\n\u6240\u6709\u4eba\u775c\u958b\u773c\u775b",callback:this.storyEnd.bind(this)},this.storyNum=0,this.storySequence=[{text:"\u5929\u9ed1\u8acb\u9589\u773c",callback:null},{text:"\u58de\u4eba\u8acb\u775c\u773c\u76f8\u8a8d",callback:this.evilSee.bind(this)},{text:"\u58de\u4eba\u8acb\u9589\u773c",callback:null},{text:"\u6885\u6797\u775c\u773c\n\n\u9664\u4e86\u83ab\u5fb7\u96f7\u5fb7\n\n\u58de\u4eba\u8c4e\u8d77\u5927\u62c7\u6307",callback:this.merlinSee.bind(this)},{text:"\u6885\u6797\u9589\u773c\n\n\u58de\u4eba\u628a\u624b\u6536\u8d77\u4f86",callback:null}],this.story.active=!0,this.existCards.active=!1,this.recordsNode.active=!1},start:function(){this.controller.hasPercival&&(this.storySequence=this.storySequence.concat(this.PERCIVALSTORY)),this.storySequence.push(this.ENDSTORY),this.setupBoard(),this.spawnCards(),this.showStory(),o._sock.onmessage=this.onPrepareMessage.bind(this),this.confirm.on("touchstart",function(){this.captain==this.controller.userId&&this.teamates.length==this.controller.tokenNeed.numbers[this.round]&&o.send({method:"COMFIRMTEAM"})}.bind(this)),this.reject.on("touchstart",function(){o.send({method:"REJECT"})}.bind(this)),this.approve.on("touchstart",function(){o.send({method:"APPROVE"})}.bind(this)),this.success.on("touchstart",function(){o.send({method:"SUCCESS"})}.bind(this)),this.fail.on("touchstart",function(){o.send({method:"FAIL"})}.bind(this))},setupBoard:function(){null!=this.controller.tokenNeed.two_fail&&(this.tokenGroup.getChildByName(this.controller.tokenNeed.two_fail.toString()).color=new cc.Color(248,89,89));var t=0,e=!0,i=!1,o=void 0;try{for(var r,s=this.controller.tokenNeed.numbers[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var a=r.value;this.tokenGroup.getChildByName(t.toString()).getChildByName("Text").getComponent(cc.Label).string=a.toString(),t+=1}}catch(t){i=!0,o=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw o}}n.foreach(this.existCards._children,function(t,e){e.active=!1,void 0!=this.controller.characters[t]&&(e.getComponent(cc.Sprite).spriteFrame=this.controller.images[this.controller.characters[t].toLowerCase()],e.active=!0)}.bind(this))},spawnCards:function(){var t=-410,e=160;n.foreach(this.controller.players,function(i,o){var n=cc.instantiate(this.playerPrefab);n.x=t,n.y=e,(t+=130)>10&&(t=-410,e-=190),n.name=o[0];var r=i+1;n.on("touchstart",this.playerClicked.bind(this,n.name)),this.cards.addChild(n),n.getComponent("Player").num=i+1,n.getComponent("Player").name=o[1],o[0]==this.controller.userId?(n.getChildByName("Num").getComponent(cc.RichText).string="<outline color=#4286f4 width=4><color=#000000>"+r+"<color></outline>",n.getChildByName("Name").getComponent(cc.RichText).string="<outline color=#4286f4 width=4><color=#000000>"+o[1]+"<color></outline>",n.getComponent("Player").changeCard(this.controller.images[this.controller.role.toLowerCase()])):(n.getChildByName("Num").getComponent(cc.RichText).string="<outline width=4><color=#000000>"+r+"<color></outline>",n.getChildByName("Name").getComponent(cc.RichText).string="<outline width=4><color=#000000>"+o[1]+"<color></outline>")}.bind(this))},playerClicked:function(t){this.assassin&&"ASSASSIN"==this.controller.role?o.send({method:"ASSASSIN",user_id:t}):this.controller.userId==this.captain&&this.chosing&&(this.teamates.includes(t)?o.send({method:"UNCHOSETEAMATE",user_id:t}):this.teamates.length<this.controller.tokenNeed.numbers[this.round]&&o.send({method:"CHOSETEAMATE",user_id:t}))},onPrepareMessage:function(t){var e=JSON.parse(t.data);if("CHOSECAPTAIN"==e.method)this.captain=e.captain,this.round=e.round,this.chosing=e.chosing,this.failed=e.failed,this.confirming=!1,this.teamates=[],0==this.failed?this.failedNode.active=!1:(this.failedNode.active=!0,this.failedNode.getChildByName("Text").getComponent(cc.Label).string=this.failed+"/5 \u6b21\u6295\u7968\u5931\u6557"),n.foreach(this.cards.children,function(t,e){e.opacity=255;var i=e.getComponent("Player");i.hideEveryMark(),e.name==this.captain&&(i.captainMark.active=!0)}.bind(this)),this.vote.active=!1,this.mission.active=!1;else if("CHOSENTEAMATE"==e.method)this.teamates=e.teamates,n.foreach(this.cards.children,function(t,e){this.teamates.includes(e.name)?e.getComponent("Player").missionMark.active=!0:e.getComponent("Player").missionMark.active=!1}.bind(this)),this.teamates.length==this.controller.tokenNeed.numbers[this.round]&&this.captain==this.controller.userId?this.confirm.active=!0:this.confirm.active=!1;else if("ASKAPPROVAL"==e.method)this.chosing=e.chosing,this.confirming=e.confirming,this.teamates=e.teamates,n.foreach(this.cards.children,function(t,e){this.teamates.includes(e.name)?e.getComponent("Player").missionMark.active=!0:(e.getComponent("Player").missionMark.active=!1,e.opacity=100)}.bind(this)),this.vote.active=!0,this.confirm.active=!1;else if("VOTECONFIRM"==e.method)e.voter==this.controller.userId&&(this.vote.active=!1),this.getPlayerCard(e.voter).voteMark.active=!0;else if("ASKSUCCESS"==e.method)e.teamate&&(this.mission.active=!0,"MERLIN"==this.controller.role||"PERCIVAL"==this.controller.role||"SERVANT"==this.controller.role?this.fail.active=!1:this.fail.active=!0),this.vote.active=!1,n.foreach(this.cards.children,function(t,e){e.getComponent("Player").voteMark.active=!1}.bind(this));else if("MISSIONCONFIRM"==e.method)e.voter==this.controller.userId&&(this.mission.active=!1),this.getPlayerCard(e.voter).foldedMissionMark.active=!0;else if("GAMERECORD"==e.method){var i="",o=!0,r=!1,s=void 0;try{for(var a,l=e.record[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var c=a.value;i+="<color=#6495ED>"+c.success+" \u6210\u529f</color>   <color=#FF6347>"+c.fail+" \u5931\u6557</color>",i+="\n<size=40>";var h=!0,d=!1,u=void 0;try{for(var p,m=c.team[Symbol.iterator]();!(h=(p=m.next()).done);h=!0){var f=p.value;i+=this.getPlayerCard(f).num+". "}}catch(t){d=!0,u=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw u}}i+="</size>\n"}}catch(t){r=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}this.recordsNode.getChildByName("RichText").getComponent(cc.RichText).string=i;var y=this.tokenGroup.getChildByName(this.round.toString()).getChildByName("token");"good"==e.record[e.record.length-1].good_evil?y.getComponent(cc.Sprite).spriteFrame=this.controller.images.good_token:y.getComponent(cc.Sprite).spriteFrame=this.controller.images.evil_token,this.teamates=[],this.round=e.round,this.mission.active=!1}else if("KILLMERLIN"==e.method){this.assassin=!0,n.foreach(e.evils_role_map,function(t,e){this.getPlayerCard(t).changeCard(this.controller.images[e.toLowerCase()])}.bind(this)),(y=this.tokenGroup.getChildByName(this.round.toString()).getChildByName("token")).getComponent(cc.Sprite).spriteFrame=this.controller.images.good_token,this.story.active=!0,this.storyLabel.string="\u58de\u4eba\u523a\u6bba\u6885\u6797",this.schedule(function(){this.story.active=!1}.bind(this),this.STORYTIME),this.mission.active=!1,n.foreach(this.cards.children,function(t,e){e.getComponent("Player").hideEveryMark(),e.opacity=255}.bind(this))}else if("ASSASSIN"==e.method)this.assassin=!1,n.foreach(e.role_map,function(t,e){this.getPlayerCard(t).changeCard(this.controller.images[e.toLowerCase()])}.bind(this)),e.is_merlin?this.storyLabel.string="\u523a\u6885\u6797\u6210\u529f !":this.storyLabel.string="\u523a\u932f\u4eba\u4e86, \u54c8\u54c8 !",this.story.active=!0;else if("END"==e.method){for(var f in console.log(e.method),e.add_token,0==e.failed?this.failedNode.active=!1:(this.failedNode.active=!0,this.failedNode.getChildByName("Text").getComponent(cc.Label).string=e.failed+" \u6b21\u6295\u7968\u5931\u6557"),e.role_map){var g=e.role_map[f].toLowerCase();this.getPlayerCard(f).changeCard(this.controller.images[g])}this.storyLabel.string="\u58de\u4eba\u52dd\u5229\uff01",this.story.active=!0,this.schedule(function(){this.story.active=!1}.bind(this),this.STORYTIME)}else console.log(e.method)},showStory:function(){this.schedule(function(){var t=this.storySequence[this.storyNum];this.storyLabel.string=t.text,null!=t.callback&&t.callback(),this.storyNum+=1},this.STORYTIME,this.storySequence.length-1,0)},isEvil:function(t){return"MORDRED"==t||"MORGANA"==t||"ASSASSIN"==t||"EVIL"==t},evilSee:function(){this.isEvil(this.controller.role)&&this.seeEvil()},merlinSee:function(){"MERLIN"==this.controller.role&&this.seeEvil()},seeEvil:function(){n.foreach(this.controller.specialPower,function(t,e){var i=this.getPlayerCard(e);i.changeCard(this.controller.images.bad),i.parent=this.showCards,this.scheduleOnce(function(){i.parent=this.cards},this.STORYTIME-.25)}.bind(this))},percivalSee:function(){"PERCIVAL"==this.controller.role&&(console.log(this.controller.specialPower),n.foreach(this.controller.specialPower,function(t,e){var i=this.getPlayerCard(e);i.changeCard(this.controller.images.morganamerlin),i.parent=this.showCards,this.scheduleOnce(function(){i.parent=this.cards},this.STORYTIME-.25)}.bind(this)))},storyEnd:function(){this.storyLabel.string="",this.story.active=!1,this.existCards.active=!0,this.recordsNode.active=!0,o.send({method:"STORYFINISH"}),this.scheduleOnce(function(){var t=!0,e=!1,i=void 0;try{for(var o,n=this.existCards._children[Symbol.iterator]();!(t=(o=n.next()).done);t=!0){var r=o.value;r.width=100,r.height=159}}catch(t){e=!0,i=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw i}}}.bind(this),.1)},getPlayerCard:function(t){return this.cards.getChildByName(t).getComponent("Player")}}),cc._RF.pop()},{Controller:"Controller",Jythons:"Jythons",NetControl:"NetControl"}],Jythons:[function(t,e,o){"use strict";cc._RF.push(e,"38e55R+jN9P2rwM69DDvoVC","Jythons"),e.exports={random:new function(){var t=this;this.randint=function(t,e){return parseInt(Math.random()*(e-t+1)+t)},this.random=function(){return Math.random()},this.shuffle=function(t){var e,i,o;for(o=t.length-1;o>0;o--)e=Math.floor(Math.random()*(o+1)),i=t[o],t[o]=t[e],t[e]=i},this.choice=function(e){return e[t.randint(0,e.length-1)]},this.sample=function(e,o){if(o>e.length)throw"Sample larger than population";var n=[];for(i=0;i<o;i++){for(pick=t.choice(e);n.indexOf(pick)>=0;)pick=t.choice(e);n.push(pick)}return n}},foreach:function(t,e){var i,o=0;if(void 0!=t.length)for(i=t.length;o<i&&!1!==e.call(t[o],o,t[o]);o++);else for(o in t)if(!1===e.call(t[o],o,t[o]))break;return t},reapeat:function(t,e){for(var i=0;i<e;i++)t.call(i,i)}},cc._RF.pop()},{}],LoginSystem:[function(t,e,i){"use strict";cc._RF.push(e,"e33862S0clGtpdPSaT89IvS","LoginSystem");var o=t("NetControl");cc.Class({extends:cc.Component,properties:{controller:{default:null,type:t("Controller")},nameInput:{default:null,type:cc.EditBox},secretInput:{default:null,type:cc.EditBox},waitingNode:{default:null,type:cc.Node},hostInput:{default:null,type:cc.EditBox},portInput:{default:null,type:cc.EditBox}},onLoad:function(){this.hostInput.string=window.location.hostname},login:function(){this.name=this.nameInput.string,this.secret=this.secretInput.string,""!=this.name&&""!=this.secret&&(o.ip="ws://"+this.hostInput.string+":"+this.portInput.string,o.connect(),o._sock.onopen=this.onLoginOpen.bind(this),o._sock.onmessage=this.onLoginMessage.bind(this),o._sock.onclose=function(t){alert("\u6c92\u6709\u9023\u7dda")})},onLoginOpen:function(){this.waitingNode.active=!0,o.send({method:"LOGIN",name:this.name,secret:this.secret})},onLoginMessage:function(t){var e=JSON.parse(t.data);if("VARIFYFAIL"==e.method)return alert("failed"),void(this.waitingNode.active=!1);"WAITING"==e.method&&(this.waitingNode.active=!1,this.controller.toPreparePage(e))}}),cc._RF.pop()},{Controller:"Controller",NetControl:"NetControl"}],NetControl:[function(t,e,i){"use strict";cc._RF.push(e,"fdc1fKzqn9Jx65LSJ81ahNo","NetControl"),e.exports={ip:"ws://"+window.location.hostname+":8000",_socket:{},connect:function(){this._sock=new WebSocket(this.ip)},send:function(t){this._sock.send(JSON.stringify(t))}},cc._RF.pop()},{}],Player:[function(t,e,i){"use strict";cc._RF.push(e,"4740fzd56NKR6tr1qi+pY/A","Player"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.name=void 0==this.name?null:this.name,this.num=void 0==this.num?null:this.num,this.card=this.node.getChildByName("Card"),this.captainMark=this.node.getChildByName("Captain"),this.missionMark=this.node.getChildByName("Mission"),this.voteMark=this.node.getChildByName("Vote"),this.foldedMissionMark=this.node.getChildByName("Foldedmission")},start:function(){},changeCard:function(t){this.card.getComponent(cc.Sprite).spriteFrame=t},hideEveryMark:function(){this.captainMark.active=!1,this.missionMark.active=!1,this.voteMark.active=!1,this.foldedMissionMark.active=!1}}),cc._RF.pop()},{}],PrepareSystem:[function(t,e,i){"use strict";cc._RF.push(e,"8c817Jxj55IaoqcqQ9iWxcG","PrepareSystem");var o=t("NetControl");cc.Class({extends:cc.Component,properties:{controller:{default:null,type:t("Controller")},connectedNumLabel:{default:null,type:cc.Label},readyNumLabel:{default:null,type:cc.Label},readyBtn:{default:null,type:cc.Toggle}},onLoad:function(){o._sock.onmessage=this.onPrepareMessage.bind(this)},onPrepareMessage:function(t){var e=JSON.parse(t.data);"WAITING"==e.method?this.connectedNumLabel.string="\u9023\u7dda\u4eba\u6578: "+e.players_num:"NEEDREADY"==e.method?(this.readyBtn.interactable=!0,this.controller.needready=!0):"CONFIRMREADY"==e.method?(e.user==this.controller.user_id&&(this.readyBtn.color=cc.hexToColor("#6495ED"),this.controller.onReady=!0),this.readyNumLabel.string="\u6e96\u5099\u4eba\u6578: "+e.player_ready):"START"==e.method&&this.controller.startGame(e)},ready:function(){this.controller.needready&&!this.controller.onReady&&(this.readyBtn.node.getChildByName("Text").getComponent(cc.Label).string="\u6e96\u5099\u6210\u529f",this.readyBtn.interactable=!1,o.send({method:"READY"}))}}),cc._RF.pop()},{Controller:"Controller",NetControl:"NetControl"}],TextureMatch:[function(t,e,i){"use strict";cc._RF.push(e,"a32adSKGdZGWqIgesSCeIds","TextureMatch"),cc.Class({extends:cc.Component,properties:{agree:{default:null,type:cc.SpriteFrame},assassin:{default:null,type:cc.SpriteFrame},bad:{default:null,type:cc.SpriteFrame},captain:{default:null,type:cc.SpriteFrame},evil_token:{default:null,type:cc.SpriteFrame},evil:{default:null,type:cc.SpriteFrame},fail:{default:null,type:cc.SpriteFrame},foldedmission:{default:null,type:cc.SpriteFrame},good_token:{default:null,type:cc.SpriteFrame},good:{default:null,type:cc.SpriteFrame},lake:{default:null,type:cc.SpriteFrame},merlin:{default:null,type:cc.SpriteFrame},mission:{default:null,type:cc.SpriteFrame},mordred:{default:null,type:cc.SpriteFrame},morganamerlin:{default:null,type:cc.SpriteFrame},morgana:{default:null,type:cc.SpriteFrame},oberon:{default:null,type:cc.SpriteFrame},percival:{default:null,type:cc.SpriteFrame},reject:{default:null,type:cc.SpriteFrame},servant:{default:null,type:cc.SpriteFrame},success:{default:null,type:cc.SpriteFrame},unkown:{default:null,type:cc.SpriteFrame},vote:{default:null,type:cc.SpriteFrame}}}),cc._RF.pop()},{}]},{},["Controller","GameSystem","Jythons","LoginSystem","NetControl","Player","PrepareSystem","TextureMatch"]);